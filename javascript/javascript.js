let posts = [

    {
        id: '1',
        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',
        createdAt: new Date('2020-03-17T23:01:00'),
        author: 'Иванов Иван',
        photoLink: 'https://www.pressball.by/images/stories/2020/03/20200310231542.jpg',
        hashTags: [
            'coronavirus', 'virus'
        ],
        likes: [
            'Иванов Иван'
        ]
    },
    {
        id: '2',
        description: 'js4life',
        createdAt: new Date('2020-04-17T23:06:00'),
        author: 'Alex',
        photoLink: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Unofficial_JavaScript_logo_2.svg/1200px-Unofficial_JavaScript_logo_2.svg.png',
        hashTags: [
            'javascript', 'liketime'
        ],
        likes: [
            'Алексей Залесский'
        ]
    },
    {
        id: '3',
        description: 'nba time',
        createdAt: new Date('2020-03-18T23:07:00'),
        author: 'Kobe',
        photoLink: 'https://www.slamdunk.ru/forum/uploads/monthly_2020_01/c8c5b000e0d731bd1b10708e5ec88353.jpg.1b8b74abdd8a629229817a80991e0898.jpg',
        hashTags: [
            'nba', 'legend'
        ],
        likes: [
            'Alexeyka'
        ]
    },
    {
        id: '4',
        description: 'Real Madrid best club',
        createdAt: new Date('2020-06-17T23:00:00'),
        author: 'Perez',
        photoLink: 'https://statistics-stat-logos.trbna.com/champions_league/2018-19/real_madrid.png?height=28&width=28',
        hashTags: [
            'football'
        ],
        likes: []
    },
    {
        id: '5',
        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',
        createdAt: new Date('2020-08-17T23:00:00'),
        author: 'Иванов Иван',
        photoLink: 'https://www.pressball.by/images/stories/2020/03/20200310231542.jpg',
        hashTags: [
            'coronavirus', 'virus'
        ],
        likes: [
            'Иванов Иван'
        ]
    },
    {
        id: '6',
        description: 'js4life',
        createdAt: new Date('2020-01-17T23:05:00'),
        author: 'Alex',
        photoLink: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Unofficial_JavaScript_logo_2.svg/1200px-Unofficial_JavaScript_logo_2.svg.png',
        hashTags: [
            'javascript', 'liketime'
        ],
        likes: [
            'Алексей Залесский'
        ]
    },
    {
        id: '7',
        description: 'nba time',
        createdAt: new Date('2020-03-18T23:00:06'),
        author: 'Kobe',
        photoLink: 'https://www.slamdunk.ru/forum/uploads/monthly_2020_01/c8c5b000e0d731bd1b10708e5ec88353.jpg.1b8b74abdd8a629229817a80991e0898.jpg',
        hashTags: [
            'nba', 'legend'
        ],
        likes: [
            'Alexeyka'
        ]
    },
    {
        id: '8',
        description: 'Real Madrid best club',
        createdAt: new Date('2020-04-17T23:22:00'),
        author: 'Perez',
        photoLink: 'https://statistics-stat-logos.trbna.com/champions_league/2018-19/real_madrid.png?height=28&width=28',
        hashTags: [
            'football'
        ],
        likes: []
    },
    {
        id: '9',
        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',
        createdAt: new Date('2019-03-17T23:00:00'),
        author: 'Иванов Иван',
        photoLink: 'https://www.pressball.by/images/stories/2020/03/20200310231542.jpg',
        hashTags: [
            'coronavirus', 'virus'
        ],
        likes: [
            'Иванов Иван'
        ]
    },
    {
        id: '10',
        description: 'js4life',
        createdAt: new Date('2020-05-17T23:06:00'),
        author: 'Alex',
        photoLink: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Unofficial_JavaScript_logo_2.svg/1200px-Unofficial_JavaScript_logo_2.svg.png',
        hashTags: [
            'javascript', 'liketime'
        ],
        likes: [
            'Алексей Залесский'
        ]
    },
    {
        id: '11',
        description: 'nba time',
        createdAt: new Date('2020-03-18T23:00:20'),
        author: 'Kobe',
        photoLink: 'https://www.slamdunk.ru/forum/uploads/monthly_2020_01/c8c5b000e0d731bd1b10708e5ec88353.jpg.1b8b74abdd8a629229817a80991e0898.jpg',
        hashTags: [
            'nba', 'legend'
        ],
        likes: [
            'Alexeyka'
        ]
    },
    {
        id: '12',
        description: 'Real Madrid best club',
        createdAt: new Date('2020-04-17T23:00:50'),
        author: 'Perez',
        photoLink: 'https://statistics-stat-logos.trbna.com/champions_league/2018-19/real_madrid.png?height=28&width=28',
        hashTags: [
            'football'
        ],
        likes: []
    },
    {
        id: '13',
        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',
        createdAt: new Date('2020-09-17T23:00:30'),
        author: 'Иванов Иван',
        photoLink: 'https://www.pressball.by/images/stories/2020/03/20200310231542.jpg',
        hashTags: [
            'coronavirus', 'virus'
        ],
        likes: [
            'Иванов Иван'
        ]
    },
    {
        id: '14',
        description: 'js4life',
        createdAt: new Date('2020-03-17T23:00:00'),
        author: 'Alex',
        photoLink: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Unofficial_JavaScript_logo_2.svg/1200px-Unofficial_JavaScript_logo_2.svg.png',
        hashTags: [
            'javascript', 'liketime'
        ],
        likes: [
            'Алексей Залесский'
        ]
    },
    {
        id: '15',
        description: 'nba time',
        createdAt: new Date('2020-06-18T23:00:00'),
        author: 'Kobe',
        photoLink: 'https://www.slamdunk.ru/forum/uploads/monthly_2020_01/c8c5b000e0d731bd1b10708e5ec88353.jpg.1b8b74abdd8a629229817a80991e0898.jpg',
        hashTags: [
            'nba', 'legend'
        ],
        likes: [
            'Alexeyka'
        ]
    },
    {
        id: '16',
        description: 'Real Madrid best club',
        createdAt: new Date('2020-04-17T23:20:00'),
        author: 'Perez',
        photoLink: 'https://statistics-stat-logos.trbna.com/champions_league/2018-19/real_madrid.png?height=28&width=28',
        hashTags: [
            'football'
        ],
        likes: []
    },
    {
        id: '17',
        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',
        createdAt: new Date('2020-07-17T23:02:00'),
        author: 'Иванов Иван',
        photoLink: 'https://www.pressball.by/images/stories/2020/03/20200310231542.jpg',
        hashTags: [
            'coronavirus', 'virus'
        ],
        likes: [
            'Иванов Иван'
        ]
    },
    {
        id: '18',
        description: 'js4life',
        createdAt: new Date('2020-04-17T23:45:00'),
        author: 'Alex',
        photoLink: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Unofficial_JavaScript_logo_2.svg/1200px-Unofficial_JavaScript_logo_2.svg.png',
        hashTags: [
            'javascript', 'liketime'
        ],
        likes: [
            'Алексей Залесский'
        ]
    },
    {
        id: '19',
        description: 'nba time',
        createdAt: new Date('2020-03-18T23:34:00'),
        author: 'Kobe',
        photoLink: 'https://www.slamdunk.ru/forum/uploads/monthly_2020_01/c8c5b000e0d731bd1b10708e5ec88353.jpg.1b8b74abdd8a629229817a80991e0898.jpg',
        hashTags: [
            'nba', 'legend'
        ],
        likes: [
            'Alexeyka'
        ]
    },
    {
        id: '20',
        description: 'Real Madrid best club',
        createdAt: new Date('2020-04-17T22:00:00'),
        author: 'Perez',
        photoLink: 'https://statistics-stat-logos.trbna.com/champions_league/2018-19/real_madrid.png?height=28&width=28',
        hashTags: [
            'football'
        ],
        likes: []
    },

];

function getPosts(skip = 0, top = 10, filterConfig = undefined) {
    if (typeof skip !== 'number' || typeof top !== 'number') {
        console.log('Error with inputting types!');
        return;
    }

    if (filterConfig){
        let returningPosts = posts;

        for (let param in filterConfig){
            if (param === 'hashTags'){
                for (let i = 0; i < filterConfig.hashTags.length; i++){
                    returningPosts = returningPosts.filter(post => post.hashTags.includes(filterConfig.hashTags[i]));
                }
            }
            else if (param === 'dateFrom'){
                returningPosts = returningPosts.filter(post => post.createdAt >= filterConfig.dateFrom);
            }
            else if (param === 'dateTo'){
                returningPosts = returningPosts.filter(post => post.createdAt < filterConfig.dateTo);
            }
            else if (param === 'author'){
                returningPosts = returningPosts.filter(post => post.author === filterConfig.author);
            }
        }

        returningPosts.sort(comparator);

        return returningPosts.slice(skip, skip + top);
    }
    else {
        let returningPosts = posts.slice(skip, skip + top);

        returningPosts.sort(comparator);

        return returningPosts;
    }
}
function comparator(first, second) {
    if (first.createdAt < second.createdAt){
        return 1;
    }
    else if (first.createdAt > second.createdAt){
        return -1;
    }
    else{
        return 0;
    }
}

function getPost(id) {
    if (typeof id === 'string'){
        return posts.find(post => post.id === id);
    }
    else {
        console.log('Incorrect type of id. Use \'string\'');
    }
}

function validatePost(post, params = ['id', 'description', 'author', 'createdAt', 'photoLink', 'hashTags', 'likes']) {
    return params.every(function (param) {
        switch (param) {
            case 'id':
                if (!post.id || typeof post.id !== 'string'){
                    return false;
                }
                break;
            case 'description':
                if (!post.description || typeof post.description !== 'string' || post.description.length > 250){
                    return false;
                }
                break;
            case 'author':
                if (!post.author || typeof post.author !== 'string'){
                    return false;
                }
                break;
            case 'createdAt':
                if (!post.createdAt || Object.prototype.toString.call(post.createdAt) !== '[object Date]'){
                    return false;
                }
                break;
            case 'photoLink':
                if (post.photoLink && typeof post.photoLink !== 'string'){
                    return false;
                }
                break;
            case 'hashTags':
                if (post.hashTags){
                    if (!post.hashTags.every(tag => typeof tag === 'string')){
                        return false;
                    }
                }
                break;
            case 'likes':
                if (post.likes){
                    if (!post.likes.every(like => typeof like === 'string')){
                        return false;
                    }
                }
                break;
            default:
                return false;
        }
        return true;
    });
}

function addPost(post){
    if (validatePost(post)){
        posts.push(post);
        return true;
    }
    return false;
}

function editPost(id, post){
    for (let param in post){
        if (param === 'id' || param === 'author' || param === 'createdAt'){
            console.log("Error ");
            return false;
        }
    }

    if(!validatePost(post, Object.keys(post))){
        return false;
    }

    let editingPost = getPost(id);

    for (let param in post){
        editingPost[param] = post[param];
    }

    return true;
}

function deletePost(id){
    if (typeof id === 'string'){
        let index = posts.findIndex(post => post.id === id);

        if (index !== -1){
            posts.splice(index, 1);

            return true;
        }
    }
    return false;
}
console.log("first 3 posts");
console.log(getPosts(0,3));
console.log("first 3 posts after 3rd post");
console.log(getPosts(3,3));
console.log("Posts by Alex");
console.log(getPosts(0,2,{author: 'Alex'}));
console.log("Get post by ID");
console.log(getPost('5'));
console.log("Get not existing post");
console.log(getPost('24'));
console.log("Check validating");
console.log(validatePost({id: '124', createdAt: new Date(),  description: 'Hello', author:'Its me', hashTags: ['i was wondering']}));
console.log("Check validating without param");
console.log(validatePost({ createdAt: new Date(),  description: 'Hello', author:'Its me', hashTags: ['i was wondering']}));
console.log("Add Post");
console.log(addPost({id: '21', createdAt: new Date(),  description: 'New Post', author:'Stephen King', hashTags: ['post']}));
console.log(getPost('21'));
console.log("Edit post and get");
editPost( '21',{description: "edit", hashTags: ['edit this']});
console.log(getPost('21'));
console.log("Edit unchangable param");
editPost( '24',{ id: "34" ,description: "edit", hashTags: ['edit this']});
console.log("Delete post");
deletePost('24');
console.log(getPost('24'));
